<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>APARS - Station</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="js/menu.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>

    <style>
        /* Theme Variables */
        :root {
            --background-color: #ffffff;
            --text-color: #000000;
            --button-bg: #000000;
            --button-text: #ffffff;
        }

        .dark-mode {
            --background-color: #1e1e1e;
            --text-color: #ffffff;
            --button-bg: #ffffff;
            --button-text: #000000;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        /* Theme Toggle Switch */
        .theme-switch-wrapper {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .theme-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 25px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 25px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 3.5px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }
    </style>

    <script>
        window.onload = function() {
            // Load user preferences
            const theme = localStorage.getItem('theme') || 'light';
            setTheme(theme);

            const replaceTimestamp = localStorage.getItem('replaceTimestamp') === 'true';
            document.getElementById('toggle-status').textContent = replaceTimestamp ? "Enabled" : "Disabled";

            if (replaceTimestamp) {
                updateIframesWithTimestamp();
            }
        };

        function updateIframesWithTimestamp() {
            const iframes = document.querySelectorAll('iframe');
            const currentTimestamp = Date.now();

            iframes.forEach(iframe => {
                let src = iframe.getAttribute('src');
                if (src.includes('from=') && src.includes('to=')) {
                    src = src.replace(/from=\d+/, `from=${currentTimestamp - 60000}`);
                    src = src.replace(/to=\d+/, `to=${currentTimestamp}`);
                    iframe.setAttribute('src', src);
                }
            });
        }

        function toggleTimestampReplacement() {
            const currentStatus = localStorage.getItem('replaceTimestamp') === 'true';
            const newStatus = !currentStatus;
            localStorage.setItem('replaceTimestamp', newStatus);
            location.reload();
        }

        function toggleTheme() {
            const isDarkMode = document.getElementById("theme-toggle-checkbox").checked;
            const theme = isDarkMode ? "dark" : "light";
            setTheme(theme);
        }

        function setTheme(theme) {
            localStorage.setItem("theme", theme);
            document.body.classList.toggle('dark-mode', theme === 'dark');

            // Update toggle switch position
            document.getElementById("theme-toggle-checkbox").checked = theme === 'dark';

            // Update all iframes to use the correct theme
            document.querySelectorAll('iframe').forEach(iframe => {
                let src = iframe.getAttribute("src");

                if (src.includes("theme=")) {
                    src = src.replace(/theme=(dark|light)/, `theme=${theme}`);
                } else {
                    src = src + `&theme=${theme}`;
                }

                iframe.setAttribute("src", src);
            });
        }

        // Apply stored theme preference on page load
        document.addEventListener("DOMContentLoaded", () => {
            const savedTheme = localStorage.getItem("theme") || "light";
            setTheme(savedTheme);
        });
    </script>
</head>

<body>

    <div class="theme-switch-wrapper">
        <label class="theme-switch">
            <input type="checkbox" id="theme-toggle-checkbox" onclick="toggleTheme()">
            <span class="slider round"></span>
        </label>
    </div>

    <div class="navbar">
        <!-- Menu Icon and APARS Logo -->
        <div class="menu-logo">
            <span class="menu-icon" onclick="openMenu()">☰</span>
            <div class="logo">APARS</div>
        </div>
        
        <!-- Current Date and Time -->
        <div id="datetime" class="date-user"></div>
    </div>
    
    <!-- Side Menu -->
    <div id="side-menu" class="side-menu">
        <a href="javascript:void(0)" class="close-btn" onclick="closeMenu()">×</a>
        <a href="index.html">Home</a>
        <a href="car.html">Cars</a>
        <a href="#">Stations</a>
        <a href="about.html">About</a>
    </div>

    <!-- Grafana Dashboards -->
    <iframe src="https://labserver.sense-campus.gr:8087/d-solo/eea3q6iccswlca/station-dashboards?from=1738986230693&to=1739007830693&timezone=browser&refresh=5m&orgId=2&panelId=1&__feature.dashboardSceneSolo&theme=light" 
    width="80%" height="600px" style="margin-top: 10px; margin-left: 10%; margin-right: 10%; padding: 0%;" frameborder="0"></iframe>

    <iframe src="https://labserver.sense-campus.gr:8087/d-solo/eea3q6iccswlca/station-dashboards?from=1738985275959&to=1739006875960&timezone=browser&refresh=5m&orgId=2&panelId=2&__feature.dashboardSceneSolo&theme=light" 
    width="80%" height="400px" style="margin-top: 10px; margin-left: 10%; margin-right: 10%; padding: 0%;" frameborder="0"></iframe>

    <div style="text-align: center; margin-top: 20px;">
        <button onclick="toggleTimestampReplacement()" style="padding: 10px 20px; font-size: 16px;">Toggle Demo/Real</button>
        <p>View current data is currently: <span id="toggle-status">Enabled</span></p>
    </div>

</body>

</html>
